# Static Linking Configuration for NetStress Titanium v3.0
# **Validates: Requirements 10.1** - Configure static linking for all dependencies

[build]
# Default to release builds for production deployment
target-dir = "../../target"

[target.x86_64-pc-windows-msvc]
rustflags = [
    # Enable static CRT linking
    "-C", "target-feature=+crt-static",
    # Exclude dynamic MSVC runtime
    "-C", "link-arg=/NODEFAULTLIB:msvcrt",
    "-C", "link-arg=/NODEFAULTLIB:vcruntime",
    # Use static MSVC runtime
    "-C", "link-arg=/DEFAULTLIB:libcmt",
    # Additional Windows-specific optimizations
    "-C", "link-arg=/OPT:REF",
    "-C", "link-arg=/OPT:ICF",
]

[target.x86_64-unknown-linux-gnu]
rustflags = [
    # Enable static CRT linking
    "-C", "target-feature=+crt-static",
    # Static link libgcc
    "-C", "link-arg=-static-libgcc",
    # Prefer static libraries
    "-C", "prefer-dynamic=no",
]

[target.x86_64-unknown-linux-musl]
rustflags = [
    # Enable static CRT linking
    "-C", "target-feature=+crt-static",
    # Full static linking for musl
    "-C", "link-arg=-static",
    # Strip symbols for smaller binary
    "-C", "link-arg=-s",
]

[target.x86_64-apple-darwin]
rustflags = [
    # Enable static CRT linking
    "-C", "target-feature=+crt-static",
    # macOS-specific optimizations
    "-C", "link-arg=-dead_strip",
]

[target.aarch64-apple-darwin]
rustflags = [
    # Enable static CRT linking for Apple Silicon
    "-C", "target-feature=+crt-static",
    # Apple Silicon optimizations
    "-C", "link-arg=-dead_strip",
    "-C", "target-cpu=apple-m1",
]

# Environment variables for static linking
[env]
# Force static linking of OpenSSL (if used)
OPENSSL_STATIC = "1"
# Force static linking of other C libraries
PKG_CONFIG_ALL_STATIC = "1"
# Disable dynamic library loading
RUSTFLAGS = "-C prefer-dynamic=no"